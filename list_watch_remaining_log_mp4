#!/usr/bin/env bash

running=$(ls *.log|wc -l)
remaining=$(ls *.mp4|wc -l)
done=$(ls normalized/*.mp4|wc -l)
total=$(echo $done + $remaining|bc)
waiting=$(echo $remaining - $running|bc)

if [ $running -gt 0 ] ; then
    echo $running Running = $(echo "scale=2; 100 * $running /  $total" | bc ) %|figlet -kct -f standard
fi
if [ $remaining -gt 0 ] ; then
    echo $remaining Remaining|figlet -kct -f standard
fi
if [ $waiting -gt 0 ] ; then
    echo $waiting Waiting|figlet -kct -f standard
fi
echo $(echo "scale=2; 100 - 100 * $remaining /  $total" | bc ) % Done|figlet -kct -f standard

width=$(echo $COLUMNS / 2 | bc)
var="list_watch_reaminin_output"
rm -f $var
touch $var
find . -maxdepth 1 \( -name "*.log" \) | while read fname; do
    tail -n 1 "${fname}" | sed "s,\x1B\[[0-9;]*[a-zA-Z],,g" >> $var
    echo " @ ${fname}" >> $var
done
echo "" >> $var

column -t -s "|@" $var
rm -f $var
