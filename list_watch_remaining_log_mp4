#!/usr/bin/env bash

disc_free.py

running=$(ls *.log 2>/dev/null|wc -l)
remaining_mp4=$(ls *.mp4 2>/dev/null|wc -l)
remaining_mkv=$(ls *.mkv 2>/dev/null|wc -l)
remaining_ogg=$(ls *.ogg 2>/dev/null|wc -l)
remaining_webm=$(ls *.webm 2>/dev/null|wc -l)
remaining_opus=$(ls *.opus 2>/dev/null|wc -l)
remaining_m4a=$(ls *.m4a 2>/dev/null|wc -l)
remaining=$(($remaining_mp4 + $remaining_mkv + $remaining_ogg + $remaining_webm + $remaining_opus + $remaining_m4a))
done_mp4=$(ls normalized/*.mp4 2>/dev/null|wc -l)
done_mkv=$(ls normalized/*.mkv 2>/dev/null|wc -l)
done_ogg=$(ls normalized/*.ogg 2>/dev/null|wc -l)
done_webm=$(ls normalized/*.webm 2>/dev/null|wc -l)
done_opus=$(ls normalized/*.opus 2>/dev/null|wc -l)
done_m4a=$(ls normalized/*.m4a 2>/dev/null|wc -l)
done=$(($done_mp4 + $done_mkv + $done_ogg + $done_webm + $done_opus + $done_m4a))
total=$(echo $done + $remaining|bc)
waiting=$(echo $remaining - $running|bc)

if [ $running -gt 0 ] ; then
    if [ $total -gt 0 ] ; then
        echo $running Running = $(echo "scale=2; 100 * $running / $total" | bc ) %|figlet -kct -f standard
    else
        echo $running Running|figlet -kct -f standard
    fi
fi
if [ $waiting -gt 0 ] ; then
    echo $waiting Waiting = $(echo "scale=2; 100 * $waiting / $total" | bc ) %|figlet -kct -f standard
fi
if [ $total -gt 0 ] ; then
    if [ $done -gt 0 ] ; then
        echo $done Done = $(echo "scale=2; 100 * $done / $total" | bc ) %|figlet -kct -f standard
    fi
fi

width=$(echo $COLUMNS / 2 | bc)
var="list_watch_remaining_output"
rm -f $var
touch $var
find . -maxdepth 1 \( -name "*.log" \) | while read fname; do
    tail_log=$(tail -n 1 "${fname}" | sed "s,\x1B\[[0-9;]*[a-zA-Z],,g")
    combined_line=$(echo "$tail_log @ ${fname}")
    combined_line="${combined_line/\%\|  /\%\|MM}"
    combined_line="${combined_line/\%\|/\%@\|}"
    combined_line="${combined_line/\| /\|@}"
    combined_line="${combined_line/\|MM/\|  }"
    combined_line="${combined_line/\/100 \[/\/100@\[}"
    combined_line="${combined_line/Second Pass: /99       Second Pass: }"

     combined_line="${combined_line/Stream 1\/1:/08Stream         1\/1:}"
     combined_line="${combined_line/Stream 1\/2:/07Stream        1•\/2:}"
     combined_line="${combined_line/Stream 2\/2:/08Stream        ·2\/2:}"
     combined_line="${combined_line/Stream 1\/3:/06Stream       1••\/3:}"
     combined_line="${combined_line/Stream 2\/3:/07Stream       ·2•\/3:}"
     combined_line="${combined_line/Stream 3\/3:/08Stream       ··3\/3:}"
     combined_line="${combined_line/Stream 1\/4:/05Stream      1•••\/4:}"
     combined_line="${combined_line/Stream 2\/4:/06Stream      ·2••\/4:}"
     combined_line="${combined_line/Stream 3\/4:/07Stream      ··3•\/4:}"
     combined_line="${combined_line/Stream 4\/4:/08Stream      ···4\/4:}"
     combined_line="${combined_line/Stream 1\/5:/04Stream     1••••\/5:}"
     combined_line="${combined_line/Stream 2\/5:/05Stream     ·2•••\/5:}"
     combined_line="${combined_line/Stream 3\/5:/06Stream     ··3••\/5:}"
     combined_line="${combined_line/Stream 4\/5:/07Stream     ···4•\/5:}"
     combined_line="${combined_line/Stream 5\/5:/08Stream     ····5\/5:}"
     combined_line="${combined_line/Stream 1\/6:/03Stream    1•••••\/6:}"
     combined_line="${combined_line/Stream 2\/6:/04Stream    ·2••••\/6:}"
     combined_line="${combined_line/Stream 3\/6:/05Stream    ··3•••\/6:}"
     combined_line="${combined_line/Stream 4\/6:/06Stream    ···4••\/6:}"
     combined_line="${combined_line/Stream 5\/6:/07Stream    ····5•\/6:}"
     combined_line="${combined_line/Stream 6\/6:/08Stream    ·····6\/6:}"
     combined_line="${combined_line/Stream 1\/7:/02Stream   1••••••\/7:}"
     combined_line="${combined_line/Stream 2\/7:/03Stream   ·2•••••\/7:}"
     combined_line="${combined_line/Stream 3\/7:/04Stream   ··3••••\/7:}"
     combined_line="${combined_line/Stream 4\/7:/05Stream   ···4•••\/7:}"
     combined_line="${combined_line/Stream 5\/7:/06Stream   ····5••\/7:}"
     combined_line="${combined_line/Stream 6\/7:/07Stream   ·····6•\/7:}"
     combined_line="${combined_line/Stream 7\/7:/08Stream   ······7\/7:}"
     combined_line="${combined_line/Stream 1\/8:/01Stream  1•••••••\/8:}"
     combined_line="${combined_line/Stream 2\/8:/02Stream  ·2••••••\/8:}"
     combined_line="${combined_line/Stream 3\/8:/03Stream  ··3•••••\/8:}"
     combined_line="${combined_line/Stream 4\/8:/04Stream  ···4••••\/8:}"
     combined_line="${combined_line/Stream 5\/8:/05Stream  ····5•••\/8:}"
     combined_line="${combined_line/Stream 6\/8:/06Stream  ·····6••\/8:}"
     combined_line="${combined_line/Stream 7\/8:/07Stream  ······7•\/8:}"
     combined_line="${combined_line/Stream 8\/8:/08Stream  ·······8\/8:}"
     combined_line="${combined_line/Stream 1\/9:/00Stream 1••••••••\/9:}"
     combined_line="${combined_line/Stream 2\/9:/01Stream ·2•••••••\/9:}"
     combined_line="${combined_line/Stream 3\/9:/02Stream ··3••••••\/9:}"
     combined_line="${combined_line/Stream 4\/9:/03Stream ···4•••••\/9:}"
     combined_line="${combined_line/Stream 5\/9:/04Stream ····5••••\/9:}"
     combined_line="${combined_line/Stream 6\/9:/05Stream ·····6•••\/9:}"
     combined_line="${combined_line/Stream 7\/9:/06Stream ······7••\/9:}"
     combined_line="${combined_line/Stream 8\/9:/07Stream ·······8•\/9:}"
     combined_line="${combined_line/Stream 9\/9:/08Stream ········9\/9:}"

     combined_line="${combined_line/Stream 1\/10:/00Stream 1•••••⊙⊙\/10:}"
     combined_line="${combined_line/Stream 2\/10:/01Stream 2••••••⊙\/10:}"
     combined_line="${combined_line/Stream 3\/10:/02Stream 3•••••••\/10:}"
     combined_line="${combined_line/Stream 4\/10:/03Stream ·4••••••\/10:}"
     combined_line="${combined_line/Stream 5\/10:/04Stream ··5•••••\/10:}"
     combined_line="${combined_line/Stream 6\/10:/05Stream ···6••••\/10:}"
     combined_line="${combined_line/Stream 7\/10:/06Stream ····7•••\/10:}"
     combined_line="${combined_line/Stream 8\/10:/07Stream ·····8••\/10:}"
     combined_line="${combined_line/Stream 9\/10:/08Stream ······9•\/10:}"
    combined_line="${combined_line/Stream 10\/10:/09Stream ······10\/10:}"

     combined_line="${combined_line/Stream 1\/11:/00Stream 1••••⊙⊙⊙\/11:}"
     combined_line="${combined_line/Stream 2\/11:/01Stream 2•••••⊙⊙\/11:}"
     combined_line="${combined_line/Stream 3\/11:/02Stream 3••••••⊙\/11:}"
     combined_line="${combined_line/Stream 4\/11:/03Stream 4•••••••\/11:}"
     combined_line="${combined_line/Stream 5\/11:/04Stream ·5••••••\/11:}"
     combined_line="${combined_line/Stream 6\/11:/05Stream ··6•••••\/11:}"
     combined_line="${combined_line/Stream 7\/11:/06Stream ···7••••\/11:}"
     combined_line="${combined_line/Stream 8\/11:/07Stream ····8•••\/11:}"
     combined_line="${combined_line/Stream 9\/11:/08Stream ·····9••\/11:}"
    combined_line="${combined_line/Stream 10\/11:/09Stream ·····10•\/11:}"
    combined_line="${combined_line/Stream 11\/11:/10Stream ······11\/11:}"

     combined_line="${combined_line/Stream 1\/12:/00Stream 1•••⊙⊙⊙⊙\/12:}"
     combined_line="${combined_line/Stream 2\/12:/01Stream 2••••⊙⊙⊙\/12:}"
     combined_line="${combined_line/Stream 3\/12:/02Stream 3•••••⊙⊙\/12:}"
     combined_line="${combined_line/Stream 4\/12:/03Stream 4••••••⊙\/12:}"
     combined_line="${combined_line/Stream 5\/12:/04Stream 5•••••••\/12:}"
     combined_line="${combined_line/Stream 6\/12:/05Stream ·6••••••\/12:}"
     combined_line="${combined_line/Stream 7\/12:/06Stream ··7•••••\/12:}"
     combined_line="${combined_line/Stream 8\/12:/07Stream ···8••••\/12:}"
     combined_line="${combined_line/Stream 9\/12:/08Stream ····9•••\/12:}"
    combined_line="${combined_line/Stream 10\/12:/09Stream ····10••\/12:}"
    combined_line="${combined_line/Stream 11\/12:/10Stream ·····11•\/12:}"
    combined_line="${combined_line/Stream 12\/12:/11Stream ······12\/12:}"


    echo "${combined_line}" | sed \
-e 's/\[\([[:digit:]]:[[:digit:]]\+:[[:digit:]]\+\)/\[ \1/g' \
-e 's/\[\([[:digit:]]\+:[[:digit:]]\+\)/\[   \1/g' \
-e 's/<\([[:digit:]]\+:[[:digit:]]\+\),/<   \1,/g' \
-e 's/<\([[:digit:]]:[[:digit:]]\+:[[:digit:]]\+\),/< \1,/g' \
-e 's/</ < /g' -e 's/< ?,/<      ?  ,/g' \
-e 's/, ?it\/s\]/,   ?  it\/s\]/g' \
-e 's/<    00:0\([[:digit:]]\),/<        \1,/g' \
-e 's/<    00:\([[:digit:]]\+\),/<       \1,/g' \
-e 's/<    0\([[:digit:]]:[[:digit:]]\+\),/<     \1,/g' \
-e 's/<    \([[:digit:]]\+:[[:digit:]]\+\),/<    \1,/g' \
-e 's/\[   00:0\([[:digit:]]\) </\[       \1 </g' \
-e 's/\[   00:\([[:digit:]]\+\) </\[      \1 </g' \
-e 's/\[   0\([[:digit:]]:[[:digit:]]\+\) </\[    \1 </g' \
-e 's/\[   \([[:digit:]]\+:[[:digit:]]\+\) </\[   \1 </g' \
-e 's/\([[:digit:]]\)\(.*\):\( \+[[:digit:]]\+%\)/\1\3 \2:\3/g' \
-e 's/\([[:digit:]]\)   /\1  0/g' \
>> $var
    # echo "${combined_line}" >> $var
done
echo "" >> $var

#  [   01:04 <    00:17,  1.17it/s]
#  1.16s/it]    ./The Gentlemen_2019 - bonus 07.mp4.log
#   , ?it/s]        ./Willkommen bei den Sch'tis_2008 - bonus 03.mp4.log


cat $var | sort > var2
mv var2 $var

column -t -s "@" $var
rm -f $var

echo ""
echo $PWD
screen -ls